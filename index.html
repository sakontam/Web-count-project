<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>เว็บง่ายๆที่คุณก็ทำได้</title>
    <link
      rel="icon"
      href="183dcbf6-fd89-4138-86ee-17e3e153fbf7.jpg"
      type="image/x-icon"
    />
  </head>
  <body>
    <div>
      <h1>คุณเป็นคนที่</h1>
      <h2 id="counter">กำลังโหลด...</h2>
      <h3>ไม่มีอะไรให้หรอก</h3>
      <h3>แค่อยากรู้จะมีคนสแกนกี่คน</h3>
    </div>
  </body>
  <script>
    // เคลียร์ localStorage ถ้าเป็น session ใหม่
    if (!sessionStorage.getItem("session_active")) {
      localStorage.removeItem("refreshCount");
      localStorage.removeItem("refreshTimestamps");
    }
    sessionStorage.setItem("session_active", "true");

    // ถ้าเป็นการรีโหลด
    if (performance.navigation.type === 1) {
      let refreshCount = parseInt(localStorage.getItem("refreshCount") || "0");
      refreshCount += 1;
      localStorage.setItem("refreshCount", refreshCount);

      // เพิ่ม timestamp ของการรีเฟรช
      let timestamps = JSON.parse(
        localStorage.getItem("refreshTimestamps") || "[]"
      );
      const now = Date.now();
      timestamps.push(now);

      // เก็บแค่ 1 วินาทีล่าสุด
      timestamps = timestamps.filter((ts) => now - ts <= 5000);
      localStorage.setItem("refreshTimestamps", JSON.stringify(timestamps));

      // ถ้ารีเกิน 2 ครั้งใน 5 วินาที → ปิดเว็บ
      if (timestamps.length >= 5) {
        alert("บอกอยู่ไม่ให้รีดื้อดีนัก");
        window.location.href = "https://www.youtube.com/watch?v=dQw4w9WgXcQ";
      }

      document.getElementById("counter").textContent = "ไม่ให้รีจ้า";
    }

    // ดักการกด F5 / Ctrl+R และการปัดหน้าจอ
    window.addEventListener("keydown", function (e) {
      if (e.key === "F5") {
        e.preventDefault();
        document.getElementById("counter").textContent = "ไม่ให้กด F5 นะจ๊ะ";
      } else if (e.ctrlKey && e.key === "r") {
        e.preventDefault();
        document.getElementById("counter").textContent =
          "ไม่ให้กด CTRL+R นะจ๊ะ";
      }
    });

    // ป้องกันการรีเฟรชจากการปัดลงในมือถือ
    window.addEventListener("beforeunload", function (e) {
      e.preventDefault();
      e.returnValue = "";
      return "";
    });

    if (performance.navigation.type !== 1) {
      fetch("https://web-count-project.onrender.com/count", {
        method: "GET",
        credentials: "include",
      })
        .then((res) => res.json())
        .then((data) => {
          document.getElementById("counter").textContent = data.count;
        });
    } else {
      // ถ้าเป็นการรีโหลด ก็ไม่ให้เรียก fetch
      console.log("ไม่เรียก fetch เพราะเป็นการรีเฟรช");
    }
  </script>
  <style>
    html {
      height: 100%;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: Arial, sans-serif;
      background-image: url("Minecraft_2024.10.28-22.45.png");
      background-size: cover;
      background-position: center;
    }

    h1,
    h2 {
      text-align: center;
      font-size: 100px;
      color: #ffffff;
    }

    h3 {
      text-align: center;
      color: #ffffff;
    }

    #counter {
      font-size: 50px;
      font-weight: bold;
      text-align: center;
      margin-top: 20px;
      color: #ffffff;
      background-color: rgba(0, 0, 0, 0.6);
      padding: 10px;
      border-radius: 10px;
    }
  </style>
</html>
